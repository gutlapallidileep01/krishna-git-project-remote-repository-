Jenkins Agent Setup Using Docker + SSH (Step-by-Step Lab)
 Objective
Run a Jenkins Agent inside Docker
Connect it to Jenkins via SSH
Register it as a Jenkins Node
Verify the agent using a Pipeline job

Architecture 
Linux Server
â”œâ”€â”€ Jenkins Master (Host)
â”œâ”€â”€ Docker
â”‚   â””â”€â”€ Jenkins Agent (Docker Container)
â”‚        â””â”€â”€ SSH + Java + Maven + Git

ğŸ”¹ PART 1: Prerequisites
1ï¸âƒ£ Jenkins Installed on Linux Server
Jenkins running on port 8080
Jenkins user exists (jenkins)
2ï¸âƒ£ Docker Installed
sudo apt update
sudo apt install docker.io -y
sudo systemctl start docker
sudo systemctl enable docker
Add Jenkins user to Docker group:
sudo usermod -aG docker jenkins
â¡ Logout & login again

ğŸ”¹ PART 2: Create Jenkins Agent Docker Image
1ï¸âƒ£ Create Directory
mkdir jenkins-docker-agent
cd jenkins-docker-agent
vi dockerfile

2ï¸âƒ£ Create Dockerfile
FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get clean && \
    rm -rf /var/lib/apt/lists/* && \
    apt-get update && \
    apt-get install -y \
        openssh-server \
        openjdk-17-jdk \
        git \
        maven \
        curl && \
    mkdir /var/run/sshd && \
    rm -rf /var/lib/apt/lists/*

RUN useradd -m -s /bin/bash jenkins && \
    echo "jenkins:jenkins" | chpasswd

RUN sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config && \
    sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin no/' /etc/ssh/sshd_config

RUN mkdir -p /home/jenkins/.ssh && \
    chown -R jenkins:jenkins /home/jenkins/.ssh && \
    chmod 700 /home/jenkins/.ssh

EXPOSE 22
CMD ["/usr/sbin/sshd", "-D"]

3ï¸âƒ£ Build Docker Image
docker build -t jenkins-agent .

ğŸ”¹ PART 3: Run Jenkins Agent Container
docker run -d \
  --name jenkins-agent-1 \
  -p 2222:22 \
  jenkins-agent
Verify:
docker ps

ğŸ”¹ PART 4: Configure SSH Key Authentication
1ï¸âƒ£ Generate SSH Key (Jenkins Server)
sudo su - jenkins
ssh-keygen -t rsa -b 4096

2ï¸âƒ£ Copy Public Key to Agent Container
docker exec -it jenkins-agent-1 bash
Inside container:
echo "PASTE_JENKINS_PUBLIC_KEY_HERE" >> /home/jenkins/.ssh/authorized_keys
chown -R jenkins:jenkins /home/jenkins/.ssh
chmod 700 /home/jenkins/.ssh
chmod 600 /home/jenkins/.ssh/authorized_keys
exit

3ï¸âƒ£ Test SSH (IMPORTANT)
ssh -p 2222 jenkins@localhost
âœ… Should login without password

ğŸ”¹ PART 5: Add Jenkins Agent as Node
Jenkins UI Steps
Manage Jenkins â†’ Nodes â†’ New Node
Node Configuration
Field
Value
Node name
jenkins-agent-1
Type
Permanent Agent
Remote root directory
/home/jenkins
Labels
docker
Launch method
Launch agent via SSH
Host
localhost
Port
2222
Credentials
Jenkins SSH private key
Host key verification
Non verifying
Executors
1

ğŸ‘‰ Save â†’ Click Launch Agent
âœ… Status should be Connected

ğŸ”¹ PART 6: Verify Agent Using Pipeline (TEST)
1ï¸âƒ£ Create Pipeline Job
New Item â†’ Name: verify-agent â†’ Type: Pipeline

2ï¸âƒ£ Paste Pipeline Script
pipeline {
  agent { label 'docker' }

  stages {
    stage('Verify Jenkins Agent') {
      steps {
        sh '''
          echo "Hostname:"
          hostname

          echo "User:"
          whoami

          echo "Workspace:"
          pwd

          echo "Java:"
          java -version

          echo "Maven:"
          mvn -version

          echo "Git:"
          git --version
        '''
      }
    }
  }
}

3ï¸âƒ£ Run Job
Click Build Now

